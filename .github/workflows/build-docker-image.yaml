name: Docker Image CI

on: [pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ’â€â™‚ï¸ Fetch package version from package.json
        id: image_tag
        run: |
          content="${content//'%'/'%25'}"
          content="${content//$'\n'/'%0A'}"
          content="${content//$'\r'/'%0D'}"
          echo "::set-output name=packageJson::$content"

      - name: ğŸƒâ€â™‚ï¸ Setup workflow runner
        uses: actions/checkout@v2

      - name: ğŸ— Build the Docker image
        run: docker build . --file Dockerfile --tag norriswu/what-am-i-having-today:${{fromJson(steps.image_tag.outputs.packageJson).version}}

      - name: ğŸš€ Push \the image to docker hub
        run: docker push norriswu/what-am-i-having-today:${{fromJson(steps.image_tag.outputs.packageJson).version}}
